<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel ATC</title>
  <style>
    body {
      font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
      background-color: #344f68;
      color: white;
      margin: 0;
      padding: 0;
    }

    .container {
      padding: 20px;
    }

    .card {
      background-color: #2d3748;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }

    h2 {
      font-size: 1.5rem;
      margin-bottom: 10px;
    }

    .button {
      background-color: #4CAF50;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .button:hover {
      background-color: #45a049;
    }

    .select {
      width: 100%;
      padding: 8px;
      margin: 10px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    .textarea {
      width: 100%;
      height: 100px;
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
      background-color: #2d3748;
      color: white;
    }

    .header {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 20px;
    }

    .header h1 {
      font-size: 2rem;
    }

    .notam-card {
      display: flex;
      justify-content: space-between;
    }

    .notam-card textarea {
      width: 80%;
    }

    .structure-card {
      margin-top: 20px;
    }

    /* Style for the login form */
    .login-container {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh; /* Wysoko≈õƒá ekranu */
      background-color: #1a202c;
    }

    .login-card {
      background-color: #2d3748;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      width: 300px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* Dodanie cienia do okna logowania */
    }

    .login-input {
      width: 100%; /* Pe≈Çna szeroko≈õƒá */
      padding: 10px;
      margin: 10px 0; /* Odpowiedni margines miƒôdzy elementami */
      border-radius: 5px;
      border: 1px solid #ccc;
      background-color: #2d3748;
      color: white;
      box-sizing: border-box; /* Uwzglƒôdnia padding i border w szeroko≈õci */
    }

    .login-button {
      background-color: #4CAF50;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .login-button:hover {
      background-color: #45a049;
    }

  </style>
</head>
<body>

  <!-- Login Screen -->
  <div id="loginScreen" class="login-container">
    <div class="login-card">
      <h2>Panel Logowania</h2>
      <input type="text" id="accessKey" class="login-input" placeholder="Wprowad≈∫ klucz dostƒôpu" />
      <button class="login-button" onclick="login()">Zaloguj</button>
    </div>
  </div>

  <!-- Main Content, initially hidden -->
  <div id="mainContent" style="display: none;">
    <div class="container">
      <div class="header">
        <h1 style="color: rgb(255, 255, 255); font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;">PANEL OPERACYJNY KONTROLI RUCHU LOTNICZEGO</h1>
        <img src="https://static.thenounproject.com/png/2128055-200.png" width="100" height="100">
      </div>

      <div id="clock" style="font-size: 2rem; color: white; background-color: #2d3748; padding: 10px; border-radius: 8px; text-align: center; width: 150px; margin: 10px auto;">
        ≈Åadowanie...
      </div>
      
      <script>
        function updateClock() {
          const now = new Date();
          const hours = String(now.getHours()).padStart(2, '0');
          const minutes = String(now.getMinutes()).padStart(2, '0');
          const seconds = String(now.getSeconds()).padStart(2, '0');
          const clock = document.getElementById('clock');
          clock.textContent = `${hours}:${minutes}:${seconds}`;
        }
      
        setInterval(updateClock, 1000);
        updateClock();  // Initial call to display time immediately
      </script>
      

      <div class="card notam-card">
        <div>
          <h2>NOTAM</h2>
          <select class="select" id="notamSelect" onchange="toggleOtherNotam()">
            <option>RWY change - Zmiana drogi startowej lub lƒÖdowania</option>
            <option>UAV operations - Operacje dron√≥w BSP w strefie CTR lotniska</option>
            <option>Military exercise in TMA - ƒÜwiczenia wojskowe w strefie TMA, Non-participating aircraft must avoid the area unless ATC clearance is granted - Statki powietrzne niebiorƒÖce udzia≈Çu w ƒáwiczeniach muszƒÖ unikaƒá strefy, chyba ≈ºe uzyskajƒÖ zgodƒô ATC</option>
            <option>Glider operations - Operacje szybowc√≥w w strefie TMA</option>
            <option>Training flights - Loty treningowe</option>
            <option>HEMS/ASAR Pilots are advised to exercise caution due to frequent low-level helicopter traffic - Piloci sƒÖ ostrzegani o czƒôstym ruchu ≈õmig≈Çowc√≥w na niskich wysoko≈õciach.</option>
            <option>OTHER</option>
          </select>
          <textarea class="textarea" id="otherNotam" placeholder="Wpisz inne informacje..." style="display: none;"></textarea>
        </div>
        <div>
          <button class="button" onclick="sendNotamWebhook()">Wy≈õlij NOTAM</button>
        </div>
      </div>
    
      <div style="display: flex; gap: 20px; justify-content: space-between;">
        <!-- Pierwsza karta -->
        <div class="card" style="flex: 1; padding: 15px; border: 1px solid #ddd; border-radius: 8px;">
          <h2>Depesza METAR</h2>
          <textarea class="textarea" id="metarInput" placeholder="Wprowad≈∫ depeszƒô METAR..." style="width: 80%; height: 200px;"></textarea>
          <br>
          <button class="button" onclick="sendMetarWebhook()">Wy≈õlij do Discorda</button>
        </div>
      
        <!-- Druga karta -->
        <div class="card" style="flex: 1; padding: 15px; border: 1px solid #ddd; border-radius: 8px;">
          <h2>Aktualna pogoda - Nowy Targ</h2>
          <div id="weatherInfo">
            <p>≈Åadowanie danych...</p>
          </div>
        </div>
      </div>
    
<!-- Struktura kontroli -->
<div class="structure-card card" style="display: flex; justify-content: space-between; align-items: flex-start;">
  <div style="flex: 1; font-size: 0.9rem;">
    <h2>Struktura kontroli:</h2>
    <div>üü¶Warszawa Radar: Kontroluje przestrze≈Ñ powietrznƒÖ na du≈ºych wysoko≈õciach, zarzƒÖdzajƒÖc lotami miƒôdzy regionami.</div>
    <div>üü©Krak√≥w Approach: Kieruje lotami z wy≈ºszych wysoko≈õci do podej≈õcia w pobli≈ºu lotniska Krak√≥w.</div>
    <div>üü©Krak√≥w Tower: Odpowiada za starty i lƒÖdowania na lotnisku Krak√≥w oraz ruch na p≈Çycie lotniska.</div>
    <div>üüßNowy Targ Radio: Koordynuje ruch powietrzny w okolicach Nowego Targu, szczeg√≥lnie na niskich wysoko≈õciach.</div>
    <div>üüßNowy Targ Ground: ZarzƒÖdza ruchem i obs≈ÇugƒÖ naziemnƒÖ statk√≥w na lotnisku Nowy Targ.</div>
  </div>

  <!-- Notatki kontrolera po prawej stronie -->
  <div id="notes-section" style="flex-basis: 300px; margin-left: 100px; background-color: #f9f9f9; padding: 20px; border-radius: 8px; border: 1px solid #ccc; margin-top: 20px;">
    <h3 style="color: black;">Notatki kontrolera</h3>
    <textarea id="controller-notes" rows="5" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc;" placeholder="Wpisz notatki tutaj..."></textarea>
  </div>
</div>

<div class="card">
  <h2>üìú Zg≈Çoszone plany lotu</h2>
  <ul id="plansList">≈Åadowanie plan√≥w...</ul>
</div>

<script>
  fetch("https://3f7c8888-058b-4206-9ea9-fe3178d00585-00-2sld38k0w8soq.riker.replit.dev/api/flightplans")
    .then(res => res.json())
    .then(plans => {
      const list = document.getElementById("plansList");
      list.innerHTML = "";
      plans.reverse().forEach(plan => {
        const item = document.createElement("li");
        item.textContent = `${plan.callsign}: ${plan.departure} ‚Üí ${plan.arrival} o ${plan.departureTime} (${plan.aircraft}) - ${plan.submittedBy}`;
        list.appendChild(item);
      });
    })
    .catch(() => {
      document.getElementById("plansList").innerText = "B≈ÇƒÖd ≈Çadowania plan√≥w.";
    });
</script>

    </div>
  </div>

  <script>
    const correctKey = "TOPR-Sigma1";
  
    function login() {
      const enteredKey = document.getElementById("accessKey").value;
      if (enteredKey === correctKey) {
        // Ukryj ekran logowania, poka≈º g≈Ç√≥wny panel
        document.getElementById("loginScreen").style.display = "none";
        document.getElementById("mainContent").style.display = "block";
      } else {
        alert("B≈Çƒôdny klucz dostƒôpu!");
      }
    }
  
    // Fetch weather data for Nowy Targ
    function getWeather() {
      fetch("https://wttr.in/Nowy%20Targ?format=j1")
        .then(response => response.json())
        .then(data => {
          const weather = data.current_condition[0];
          
          // Pobierz czas za≈Çadowania strony
          const loadTime = new Date(performance.timing.navigationStart);
          const currentTime = new Date();
          const timeDifference = Math.floor((currentTime - loadTime) / 1000 / 60); // Czas w minutach od za≈Çadowania strony
  
          const weatherInfo = `
            <p>Temperatura: ${weather.temp_C}¬∞C</p>
            <p>Wiatr: ${weather.windspeedKmph} km/h ${weather.winddir16Point}</p>
            <p>Widoczno≈õƒá: ${weather.visibility} km</p>
            <p>Opad: ${weather.precipMM} mm</p>
            <p>Zachmurzenie: ${weather.cloudcover}%</p>
            <p>Wilgotno≈õƒá: ${weather.humidity} %</p>
            <p>Ci≈õnienie: ${weather.pressure} hPa</p>
            <p>Temperatura odczuwalna: ${weather.temp_F}¬∞F</p>
            <p>Godzina pobrania danych pogodowych: ${loadTime.toLocaleString()}</p>
            <p>Czas od pobrania danych: ${timeDifference} minut(y)</p>
          `;
          
          document.getElementById("weatherInfo").innerHTML = weatherInfo;
        })
        .catch(error => console.error('Error fetching weather data:', error));
    }
  
    // Uruchom funkcjƒô na przyk≈Çad co 10 minut
    setInterval(getWeather, 10 * 60 * 1000); // 10 minut
  
    // Fetch flight plans (mocked example)
    function getFlightPlans() {
      // Mocking flight plans as an example
      const plans = ["Plan 1", "Plan 2", "Plan 3"];
      let flightPlansHtml = "<ul>";
      plans.forEach(plan => {
        flightPlansHtml += `<li>${plan}</li>`;
      });
      flightPlansHtml += "</ul>";
      document.getElementById("flightPlans").innerHTML = flightPlansHtml;
    }
  
    // Call the functions when the page loads
    window.onload = function() {
      getWeather();
      getFlightPlans();
    };
  
    // Funkcja wysy≈ÇajƒÖca webhook dla METAR (jako embed)
    function sendMetarWebhook() {
      const metarData = document.getElementById("metarInput").value;
      const webhookUrl = 'https://discord.com/api/webhooks/1357001398843080811/4m0YVv8RT0fXsXhwsALXj882p-UtQBDR_jfNOuJJqPk5bduKAx8evvHBOp1P_GmREKJL';
      
      const embed = {
        color: 3066993, // Zielony kolor
        title: "NOWA DEPESZA METAR",
        description: `\`\`\`${metarData}\`\`\``
      };
      
      fetch(webhookUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ embeds: [embed] })
      })
      .then(response => response.json())
      .then(data => {
        console.log('Webhook METAR wys≈Çany:', data);
      })
      .catch((error) => {
        console.error('B≈ÇƒÖd wysy≈Çania webhooka METAR:', error);
      });
    }
  
 // Funkcja do prze≈ÇƒÖczania widoczno≈õci textarea w zale≈ºno≈õci od wybranej opcji
function toggleOtherNotam() {
  const notamSelect = document.getElementById("notamSelect").value;
  const otherNotam = document.getElementById("otherNotam");
  
  // Je≈õli wybrano "OTHER", poka≈º textarea
  if (notamSelect === "OTHER") {
    otherNotam.style.display = "block";
  } else {
    otherNotam.style.display = "none";
  }
}

function sendNotamWebhook() {
  const notamSelect = document.getElementById("notamSelect").value;
  const otherNotam = document.getElementById("otherNotam").value;
  const webhookUrl = 'https://discord.com/api/webhooks/1357001398843080811/4m0YVv8RT0fXsXhwsALXj882p-UtQBDR_jfNOuJJqPk5bduKAx8evvHBOp1P_GmREKJL';
  
  let notamMessage = `\`\`\`${notamSelect}`;
  if (notamSelect === "OTHER" && otherNotam.trim() !== "") {
    notamMessage += `\n${otherNotam}`;
  }
  notamMessage += '\`\`\`';

  const embed = {
    color: 15158332, // Czerwony kolor
    title: "NOWA DEPESZA NOTAM",
    description: notamMessage
  };

  fetch(webhookUrl, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ embeds: [embed] })
  })
  .then(response => response.json())
  .then(data => {
    console.log('Webhook NOTAM wys≈Çany:', data);
  })
  .catch((error) => {
    console.error('B≈ÇƒÖd wysy≈Çania webhooka NOTAM:', error);
  });
}

  </script>
  
</body>
</html>
