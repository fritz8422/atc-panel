<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel ATC</title>
  <style>
    body {
      font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
      background-color: #344f68;
      color: white;
      margin: 0;
      padding: 0;
    }

    .container {
      padding: 20px;
    }

    .card {
      background-color: #2d3748;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }

    h2 {
      font-size: 1.5rem;
      margin-bottom: 10px;
    }

    .button {
      background-color: #4CAF50;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .button:hover {
      background-color: #45a049;
    }

    .select {
      width: 100%;
      padding: 8px;
      margin: 10px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    .textarea {
      width: 100%;
      height: 100px;
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
      background-color: #2d3748;
      color: white;
    }

    .header {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 20px;
    }

    .header h1 {
      font-size: 2rem;
    }

    .notam-card {
      display: flex;
      justify-content: space-between;
    }

    .notam-card textarea {
      width: 80%;
    }

    .structure-card {
      margin-top: 20px;
    }

    /* Style for the login form */
    .login-container {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh; /* Wysokość ekranu */
      background-color: #1a202c;
    }

    .login-card {
      background-color: #2d3748;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      width: 300px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* Dodanie cienia do okna logowania */
    }

    .login-input {
      width: 100%; /* Pełna szerokość */
      padding: 10px;
      margin: 10px 0; /* Odpowiedni margines między elementami */
      border-radius: 5px;
      border: 1px solid #ccc;
      background-color: #2d3748;
      color: white;
      box-sizing: border-box; /* Uwzględnia padding i border w szerokości */
    }

    .login-button {
      background-color: #4CAF50;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .login-button:hover {
      background-color: #45a049;
    }

  </style>
</head>
<body>

  <!-- Login Screen -->
  <div id="loginScreen" class="login-container">
    <div class="login-card">
      <h2>Panel Logowania</h2>
      <input type="text" id="accessKey" class="login-input" placeholder="Wprowadź klucz dostępu" />
      <button class="login-button" onclick="login()">Zaloguj</button>
    </div>
  </div>

  <!-- Main Content, initially hidden -->
  <div id="mainContent" style="display: none;">
    <div class="container">
      <div class="header">
        <h1 style="color: rgb(255, 255, 255); font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;">PANEL OPERACYJNY KONTROLI RUCHU LOTNICZEGO</h1>
        <img src="https://static.thenounproject.com/png/2128055-200.png" width="100" height="100">
      </div>

      <div id="clock" style="font-size: 2rem; color: white; background-color: #2d3748; padding: 10px; border-radius: 8px; text-align: center; width: 150px; margin: 10px auto;">
        Ładowanie...
      </div>
      
      <script>
        function updateClock() {
          const now = new Date();
          const hours = String(now.getHours()).padStart(2, '0');
          const minutes = String(now.getMinutes()).padStart(2, '0');
          const seconds = String(now.getSeconds()).padStart(2, '0');
          const clock = document.getElementById('clock');
          clock.textContent = `${hours}:${minutes}:${seconds}`;
        }
      
        setInterval(updateClock, 1000);
        updateClock();  // Initial call to display time immediately
      </script>
      

      <div class="card notam-card">
        <div>
          <h2>NOTAM</h2>
          <select class="select" id="notamSelect" onchange="toggleOtherNotam()">
            <option>RWY change - Zmiana drogi startowej lub lądowania</option>
            <option>UAV operations - Operacje dronów BSP w strefie CTR lotniska</option>
            <option>Military exercise in TMA - Ćwiczenia wojskowe w strefie TMA, Non-participating aircraft must avoid the area unless ATC clearance is granted - Statki powietrzne niebiorące udziału w ćwiczeniach muszą unikać strefy, chyba że uzyskają zgodę ATC</option>
            <option>Glider operations - Operacje szybowców w strefie TMA</option>
            <option>Training flights - Loty treningowe</option>
            <option>HEMS/ASAR Pilots are advised to exercise caution due to frequent low-level helicopter traffic - Piloci są ostrzegani o częstym ruchu śmigłowców na niskich wysokościach.</option>
            <option>OTHER</option>
          </select>
          <textarea class="textarea" id="otherNotam" placeholder="Wpisz inne informacje..." style="display: none;"></textarea>
        </div>
        <div>
          <button class="button" onclick="sendNotamWebhook()">Wyślij NOTAM</button>
        </div>
      </div>
    
      <div style="display: flex; gap: 20px; justify-content: space-between;">
        <!-- Pierwsza karta -->
        <div class="card" style="flex: 1; padding: 15px; border: 1px solid #ddd; border-radius: 8px;">
          <h2>Depesza METAR</h2>
          <textarea class="textarea" id="metarInput" placeholder="Wprowadź depeszę METAR..." style="width: 80%; height: 200px;"></textarea>
          <br>
          <button class="button" onclick="sendMetarWebhook()">Wyślij do Discorda</button>
        </div>
      
        <!-- Druga karta -->
        <div class="card" style="flex: 1; padding: 15px; border: 1px solid #ddd; border-radius: 8px;">
          <h2>Aktualna pogoda - Nowy Targ</h2>
          <div id="weatherInfo">
            <p>Ładowanie danych...</p>
          </div>
        </div>
      </div>
    
<!-- Struktura kontroli -->
<div class="structure-card card" style="display: flex; justify-content: space-between; align-items: flex-start;">
  <div style="flex: 1; font-size: 0.9rem;">
    <h2>Struktura kontroli:</h2>
    <div>🟦Warszawa Radar: Kontroluje przestrzeń powietrzną na dużych wysokościach, zarządzając lotami między regionami.</div>
    <div>🟩Kraków Approach: Kieruje lotami z wyższych wysokości do podejścia w pobliżu lotniska Kraków.</div>
    <div>🟩Kraków Tower: Odpowiada za starty i lądowania na lotnisku Kraków oraz ruch na płycie lotniska.</div>
    <div>🟧Nowy Targ Radio: Koordynuje ruch powietrzny w okolicach Nowego Targu, szczególnie na niskich wysokościach.</div>
    <div>🟧Nowy Targ Ground: Zarządza ruchem i obsługą naziemną statków na lotnisku Nowy Targ.</div>
  </div>

  <!-- Notatki kontrolera po prawej stronie -->
  <div id="notes-section" style="flex-basis: 300px; margin-left: 100px; background-color: #f9f9f9; padding: 20px; border-radius: 8px; border: 1px solid #ccc; margin-top: 20px;">
    <h3 style="color: black;">Notatki kontrolera</h3>
    <textarea id="controller-notes" rows="5" style="width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc;" placeholder="Wpisz notatki tutaj..."></textarea>
  </div>
</div>

<div id="flightPlans" class="container">
  <h2>📋 Plany lotu</h2>
</div>


    </div>
  </div>

  <script>
     async function fetchFlightPlans() {
    const res = await fetch("https://3f7c8888-058b-4206-9ea9-fe3178d00585-00-2sld38k0w8soq.riker.replit.dev/api/flightplans");
    const plans = await res.json();

    const container = document.getElementById("flightPlans");
    container.innerHTML = ""; // Czyścimy

    plans.forEach(plan => {
      const el = document.createElement("div");
      el.className = "card";
      el.innerHTML = `
        <h3>🛫 ${plan.callsign}</h3>
        <p><strong>Odlot:</strong> ${plan.departure}</p>
        <p><strong>Przylot:</strong> ${plan.arrival}</p>
        <p><strong>Typ:</strong> ${plan.aircraft}</p>
        <p><strong>Godzina:</strong> ${plan.departureTime}</p>
        <p><strong>Zgłoszone przez:</strong> ${plan.submittedBy}</p>
      `;
      container.appendChild(el);
    });
  }

  // Odświeżaj co 10 sekund
  setInterval(fetchFlightPlans, 10000);
  fetchFlightPlans();
    const correctKey = "TOPR-Sigma1";
  
    function login() {
      const enteredKey = document.getElementById("accessKey").value;
      if (enteredKey === correctKey) {
        // Ukryj ekran logowania, pokaż główny panel
        document.getElementById("loginScreen").style.display = "none";
        document.getElementById("mainContent").style.display = "block";
      } else {
        alert("Błędny klucz dostępu!");
      }
    }
  
    // Fetch weather data for Nowy Targ
    function getWeather() {
      fetch("https://wttr.in/Nowy%20Targ?format=j1")
        .then(response => response.json())
        .then(data => {
          const weather = data.current_condition[0];
          
          // Pobierz czas załadowania strony
          const loadTime = new Date(performance.timing.navigationStart);
          const currentTime = new Date();
          const timeDifference = Math.floor((currentTime - loadTime) / 1000 / 60); // Czas w minutach od załadowania strony
  
          const weatherInfo = `
            <p>Temperatura: ${weather.temp_C}°C</p>
            <p>Wiatr: ${weather.windspeedKmph} km/h ${weather.winddir16Point}</p>
            <p>Widoczność: ${weather.visibility} km</p>
            <p>Opad: ${weather.precipMM} mm</p>
            <p>Zachmurzenie: ${weather.cloudcover}%</p>
            <p>Wilgotność: ${weather.humidity} %</p>
            <p>Ciśnienie: ${weather.pressure} hPa</p>
            <p>Temperatura odczuwalna: ${weather.temp_F}°F</p>
            <p>Godzina pobrania danych pogodowych: ${loadTime.toLocaleString()}</p>
            <p>Czas od pobrania danych: ${timeDifference} minut(y)</p>
          `;
          
          document.getElementById("weatherInfo").innerHTML = weatherInfo;
        })
        .catch(error => console.error('Error fetching weather data:', error));
    }
  
    // Uruchom funkcję na przykład co 10 minut
    setInterval(getWeather, 10 * 60 * 1000); // 10 minut
  
    // Fetch flight plans (mocked example)
    function getFlightPlans() {
      // Mocking flight plans as an example
      const plans = ["Plan 1", "Plan 2", "Plan 3"];
      let flightPlansHtml = "<ul>";
      plans.forEach(plan => {
        flightPlansHtml += `<li>${plan}</li>`;
      });
      flightPlansHtml += "</ul>";
      document.getElementById("flightPlans").innerHTML = flightPlansHtml;
    }
  
    // Call the functions when the page loads
    window.onload = function() {
      getWeather();
      getFlightPlans();
    };
  
    // Funkcja wysyłająca webhook dla METAR (jako embed)
    function sendMetarWebhook() {
      const metarData = document.getElementById("metarInput").value;
      const webhookUrl = 'https://discord.com/api/webhooks/1357001398843080811/4m0YVv8RT0fXsXhwsALXj882p-UtQBDR_jfNOuJJqPk5bduKAx8evvHBOp1P_GmREKJL';
      
      const embed = {
        color: 3066993, // Zielony kolor
        title: "NOWA DEPESZA METAR",
        description: `\`\`\`${metarData}\`\`\``
      };
      
      fetch(webhookUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ embeds: [embed] })
      })
      .then(response => response.json())
      .then(data => {
        console.log('Webhook METAR wysłany:', data);
      })
      .catch((error) => {
        console.error('Błąd wysyłania webhooka METAR:', error);
      });
    }
  
 // Funkcja do przełączania widoczności textarea w zależności od wybranej opcji
function toggleOtherNotam() {
  const notamSelect = document.getElementById("notamSelect").value;
  const otherNotam = document.getElementById("otherNotam");
  
  // Jeśli wybrano "OTHER", pokaż textarea
  if (notamSelect === "OTHER") {
    otherNotam.style.display = "block";
  } else {
    otherNotam.style.display = "none";
  }
}

function sendNotamWebhook() {
  const notamSelect = document.getElementById("notamSelect").value;
  const otherNotam = document.getElementById("otherNotam").value;
  const webhookUrl = 'https://discord.com/api/webhooks/1357001398843080811/4m0YVv8RT0fXsXhwsALXj882p-UtQBDR_jfNOuJJqPk5bduKAx8evvHBOp1P_GmREKJL';
  
  let notamMessage = `\`\`\`${notamSelect}`;
  if (notamSelect === "OTHER" && otherNotam.trim() !== "") {
    notamMessage += `\n${otherNotam}`;
  }
  notamMessage += '\`\`\`';

  const embed = {
    color: 15158332, // Czerwony kolor
    title: "NOWA DEPESZA NOTAM",
    description: notamMessage
  };

  fetch(webhookUrl, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ embeds: [embed] })
  })
  .then(response => response.json())
  .then(data => {
    console.log('Webhook NOTAM wysłany:', data);
  })
  .catch((error) => {
    console.error('Błąd wysyłania webhooka NOTAM:', error);
  });
}

  </script>
  
</body>
</html>
